version: "3.1"

stories:
  # ==================== GESTION DES PERMISSIONS DMOE ====================
  
  - story: Ajout DMOE - Permission refusée
    steps:
      - intent: identification_demande
        entities:
          - type_demande: "DMOE"
          - intention_demande: "ajouter"
      - action: action_verifier_permission
      - slot_was_set:
          - permission: false
          - intention_demande: "ajouter"
      - action: utter_non_autoriser_add_ddr

  # ==================== FLUX PRINCIPAL ADD DMOE ====================
  
  - story: Ajout DMOE - Démarrage identification_demande
    steps:
      - intent: identification_demande
        entities:
          - type_demande: "DMOE"
          - intention_demande: "ajouter"
      - action: action_verifier_permission
      - slot_was_set:
          - permission: true
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  - story: Ajout DMOE - Démarrage provide_poste_info
    steps:
      - intent: provide_poste_info
        entities:
          - type_demande: "DMOE"
          - intention_demande: "ajouter"
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  # ==================== GESTION DE LA COMPLÉTUDE DMOE ====================
  
  - story: ADD DMOE - Données incomplètes
    steps:
      - checkpoint: traitement_completude_add_dmoe
      - slot_was_set:
          - add_ddr_is_complet: false
      - checkpoint: collecte_info_add_dmoe

  - story: ADD DMOE - Données complètes
    steps:
      - checkpoint: traitement_completude_add_dmoe
      - slot_was_set:
          - add_ddr_is_complet: true
      - action: action_confirmer_enregistrement_ddr

  # ==================== COLLECTE D'INFORMATIONS (SCOPE: ADD DMOE) ====================
  
  - story: Collecte ADD DMOE - provide_poste_info
    steps:
      - checkpoint: collecte_info_add_dmoe
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_poste_info
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  - story: Collecte ADD DMOE - provide_encadreur_info
    steps:
      - checkpoint: collecte_info_add_dmoe
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_encadreur_info
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  - story: Collecte ADD DMOE - provide_contrat_info
    steps:
      - checkpoint: collecte_info_add_dmoe
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_contrat_info
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  - story: Collecte ADD DMOE - provide_hierarchie_organisation
    steps:
      - checkpoint: collecte_info_add_dmoe
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_hierarchie_organisation
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  - story: Collecte ADD DMOE - provide_justification
    steps:
      - checkpoint: collecte_info_add_dmoe
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_justification
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  - story: Collecte ADD DMOE - provide_objectifs
    steps:
      - checkpoint: collecte_info_add_dmoe
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_objectifs
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  - story: Collecte ADD DMOE - upload_piece_jointe
    steps:
      - checkpoint: collecte_info_add_dmoe
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: upload_piece_jointe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  - story: Collecte ADD DMOE - provide_motif_budget
    steps:
      - checkpoint: collecte_info_add_dmoe
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_motif_budget
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
      - checkpoint: traitement_completude_add_dmoe

  # ==================== HISTOIRES DE CONFIRMATION DMOE ====================
  
  - story: Confirmation DMOE - Succès
    steps:
      - checkpoint: traitement_completude_add_dmoe
      - slot_was_set:
          - add_ddr_is_complet: true
      - action: action_confirmer_enregistrement_ddr
      - intent: confirm
      - action: action_submit_form_add_dmoe

  - story: Confirmation DMOE - Annulation
    steps:
      - checkpoint: traitement_completude_add_dmoe
      - slot_was_set:
          - add_ddr_is_complet: true
      - action: action_confirmer_enregistrement_ddr
      - intent: refus
      - action: utter_annulation_ajout_ddr
