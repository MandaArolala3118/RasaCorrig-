version: "3.1"

stories:
  # ==================== GESTION DES PERMISSIONS ====================
  
  - story: Ajout DDR - Permission refusée
    steps:
      - intent: identification_demande
        entities:
          - type_demande: "DDR"
          - intention_demande: "ajouter"
      - action: action_verifier_permission
      - slot_was_set:
          - permission: false
          - intention_demande: "ajouter"
      - action: utter_non_autoriser_add_ddr

  - story: Ajout DMOE - Permission refusée
    steps:
      - intent: identification_demande
        entities:
          - type_demande: "DMOE"
          - intention_demande: "ajouter"
      - action: action_verifier_permission
      - slot_was_set:
          - permission: false
          - intention_demande: "ajouter"
      - action: utter_non_autoriser_add_ddr

  # ==================== FLUX PRINCIPAL ADD DDR/DMOE ====================
  
  - story: Ajout DDR - Démarrage identification_demande
    steps:
      - intent: identification_demande
        entities:
          - type_demande: "DDR"
          - intention_demande: "ajouter"
      - action: action_verifier_permission
      - slot_was_set:
          - permission: true
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Ajout DMOE - Démarrage identification_demande
    steps:
      - intent: identification_demande
        entities:
          - type_demande: "DMOE"
          - intention_demande: "ajouter"
      - action: action_verifier_permission
      - slot_was_set:
          - permission: true
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Ajout DDR - Démarrage provide_poste_info
    steps:
      - intent: provide_poste_info
        entities:
          - type_demande: "DDR"
          - intention_demande: "ajouter"
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Ajout DMOE - Démarrage provide_poste_info
    steps:
      - intent: provide_poste_info
        entities:
          - type_demande: "DMOE"
          - intention_demande: "ajouter"
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  # ==================== GESTION DE LA COMPLÉTUDE ====================
  
  - story: ADD DDR - Données incomplètes
    steps:
      - checkpoint: traitement_completude_add_ddr
      - slot_was_set:
          - add_ddr_is_complet: false
      - checkpoint: collecte_info_add_ddr

  - story: ADD DMOE - Données incomplètes
    steps:
      - checkpoint: traitement_completude_add_ddr
      - slot_was_set:
          - add_ddr_is_complet: false
      - checkpoint: collecte_info_add_ddr

  - story: ADD DDR - Données complètes
    steps:
      - checkpoint: traitement_completude_add_ddr
      - slot_was_set:
          - add_ddr_is_complet: true
      - action: action_confirmer_enregistrement_ddr

  - story: ADD DMOE - Données complètes
    steps:
      - checkpoint: traitement_completude_add_ddr
      - slot_was_set:
          - add_ddr_is_complet: true
      - action: action_confirmer_enregistrement_ddr

  # ==================== COLLECTE D'INFORMATIONS (SCOPE: ADD DDR/DMOE) ====================
  
  - story: Collecte ADD DDR - provide_poste_info
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_poste_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - provide_poste_info
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_poste_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DDR - provide_encadreur_info
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_encadreur_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - provide_encadreur_info
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_encadreur_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DDR - provide_contrat_info
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_contrat_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - provide_contrat_info
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_contrat_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DDR - provide_hierarchie_organisation
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_hierarchie_organisation
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - provide_hierarchie_organisation
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_hierarchie_organisation
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DDR - provide_justification
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_justification
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - provide_justification
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_justification
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DDR - provide_objectifs
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_objectifs
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - provide_objectifs
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_objectifs
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DDR - provide_dotation_info
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_dotation_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - provide_dotation_info
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_dotation_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DDR - upload_piece_jointe
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: upload_piece_jointe
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - upload_piece_jointe
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: upload_piece_jointe
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DDR - provide_motif_budget
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_motif_budget
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr

  - story: Collecte ADD DMOE - provide_motif_budget
    steps:
      - checkpoint: collecte_info_add_ddr
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - intent: provide_motif_budget
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
      - checkpoint: traitement_completude_add_ddr
