version: "3.1"

rules:
  # ==================== Permission refusée ====================
  - rule: Permission refusée pour ajout DDR
    condition:
      - slot_was_set:
          - intention_demande: "ajouter"
          - permission: false
    steps:
      - action: utter_non_autoriser_add_ddr

  # ==================== GESTION DES TYPES DE DEMANDES ====================
  
  - rule: Gestion DMI - Fonctionnalité en construction
    condition:
      - slot_was_set:
          - type_demande: "DMI"
    steps:
      - action: utter_fonctionnalite_en_construction_dmi_dri

  - rule: Gestion DRI - Fonctionnalité en construction
    condition:
      - slot_was_set:
          - type_demande: "DRI"
    steps:
      - action: utter_fonctionnalite_en_construction_dmi_dri

  # ==================== Senario d'ajout DDR ====================
  - rule: Senario ADD DDR
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
    steps:
      - intent: identification_demande
        entities:
          - type_demande: "DDR"
          - intention_demande: "ajouter"
      - action: action_verifier_permission
      - slot_was_set:
          - permission: true
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
  # ==================== CONFIRMATION/REFUS ====================
  
  - rule: Confirmation ajout DDR
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - add_ddr_is_complet: true
      - slot_was_set:
          - ajout_ddr_intent: true
    steps:
      - action: action_confirmer_enregistrement_ddr
      - intent: confirm
      - action: action_submit_form_add_ddr

  - rule: Annulation ajout DDR
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
    steps:
      - action: action_confirmer_enregistrement_ddr
      - intent: refus
      - action: utter_annulation_ajout_ddr

  # ==================== COLLECTE D'INFORMATIONS (SCOPE: ADD DDR) ====================
  
  - rule: Collecte ADD DDR - provide_poste_info
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_poste_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      

  - rule: Collecte ADD DDR - provide_encadreur_info
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_encadreur_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      

  - rule: Collecte ADD DDR - provide_contrat_info
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_contrat_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      

  - rule: Collecte ADD DDR - provide_hierarchie_organisation
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_hierarchie_organisation
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      

  - rule: Collecte ADD DDR - provide_justification
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_justification
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      

  - rule: Collecte ADD DDR - provide_objectifs
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_objectifs
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      

  - rule: Collecte ADD DDR - provide_dotation_info
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_dotation_info
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      

  - rule: Collecte ADD DDR - upload_piece_jointe
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: upload_piece_jointe
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      

  - rule: Collecte ADD DDR - provide_motif_budget
    condition:
      - slot_was_set:
          - type_demande: "DDR"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_motif_budget
      - action: action_validate_slots
      - action: action_extract_dotations_secours
      - action: verify_if_all_information_is_complet_add_ddr
    wait_for_user_input: false
      
