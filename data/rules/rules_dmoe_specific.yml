version: "3.1"

rules:
  # ==================== GESTION DMOE AVEC INTENTS SPÉCIFIQUES ====================
  
  - rule: Senario ADD DMOE - Intent spécifique
    steps:
      - intent: identification_demande_dmoe
        entities:
          - type_demande: "DMOE"
          - intention_demande: "ajouter"
      - action: action_verifier_permission
      - slot_was_set:
          - permission: true
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false

  # ==================== CONFIRMATION/REFUS DMOE ====================
  
  - rule: Confirmation ajout DMOE
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - add_ddr_is_complet: true
      - slot_was_set:
          - ajout_ddr_intent: true
    steps:
      - action: action_confirmer_enregistrement_ddr
      - intent: confirm
      - action: action_submit_form_add_dmoe

  - rule: Annulation ajout DMOE
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
    steps:
      - action: action_confirmer_enregistrement_ddr
      - intent: refus
      - action: utter_annulation_ajout_ddr

  # ==================== COLLECTE D'INFORMATIONS DMOE ====================
  
  - rule: Collecte DMOE - provide_poste_info
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_poste_info_dmoe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false

  - rule: Collecte DMOE - provide_encadreur_info
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_encadreur_info_dmoe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false

  - rule: Collecte DMOE - provide_contrat_info
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_contrat_info_dmoe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false

  - rule: Collecte DMOE - provide_hierarchie_organisation
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_hierarchie_organisation_dmoe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false

  - rule: Collecte DMOE - provide_justification
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_justification_dmoe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false

  - rule: Collecte DMOE - provide_objectifs
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_objectifs_dmoe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false

  - rule: Collecte DMOE - upload_piece_jointe
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: upload_piece_jointe_dmoe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false

  - rule: Collecte DMOE - provide_motif_budget
    condition:
      - slot_was_set:
          - type_demande: "DMOE"
      - slot_was_set:
          - intention_demande: "ajouter"
      - slot_was_set:
          - ajout_ddr_intent: true
      - slot_was_set:
          - add_ddr_is_complet: false
    steps:
      - intent: provide_motif_budget_dmoe
      - action: action_validate_slots
      - action: verify_if_all_information_is_complet_add_dmoe
    wait_for_user_input: false
